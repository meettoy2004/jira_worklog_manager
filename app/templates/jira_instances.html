{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h2>Your Jira Instances</h2>
        <a href="{{ url_for('jira.add_jira_instance') }}" class="btn btn-primary">Add New Jira Instance</a>
    </div>

    {% if instances %}
        <div class="instances-table-container">
            <table class="instances-table">
                <thead>
                    <tr>
                        <th>Instance Name</th>
                        <th>URL</th>
                        <th>Username</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for instance in instances %}
                    <tr>
                        <td>
                            <strong>{{ instance.alias }}</strong>
                        </td>
                        <td>{{ instance.base_url }}</td>
                        <td>{{ instance.jira_username }}</td>
                        <td>
                            <span class="status {{ 'status-active' if instance.is_active else 'status-inactive' }}">
                                {{ 'Active' if instance.is_active else 'Inactive' }}
                            </span>
                        </td>
                        <td class="actions">
                            <a href="{{ url_for('jira.edit_jira_instance', instance_id=instance.id) }}"
                               class="btn btn-edit">Edit</a>
                            <a href="{{ url_for('jira.test_connection', instance_id=instance.id) }}"
                               class="btn btn-info" target="_blank">Test</a>
                            <a href="{{ url_for('jira.import_worklogs', instance_id=instance.id) }}"
                               class="btn btn-success"
                               onclick="return confirm('Import worklogs from the last 30 days for {{ instance.alias }}? This may take a few moments.')">
                                ðŸ“¥ Import Worklogs
                            </a>
                            <a href="{{ url_for('reports.debug_worklogs', instance_id=instance.id) }}"
                               class="btn btn-warning btn-sm" target="_blank">Debug</a>
                            <a href="{{ url_for('jira.delete_jira_instance', instance_id=instance.id) }}"
                               class="btn btn-delete"
                               onclick="return confirm('Are you sure you want to delete {{ instance.alias }}? This action cannot be undone.')">
                                Delete
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ðŸš€</div>
            <h3>No Jira Instances Configured</h3>
            <p>Get started by adding your first Jira instance to begin managing worklogs across multiple projects.</p>
            <a href="{{ url_for('jira.add_jira_instance') }}" class="btn btn-primary">Add Your First Jira Instance</a>
        </div>
    {% endif %}

    <div class="help-section">
        <h4>ðŸ“– How to get your Jira credentials</h4>
        <ol>
            <li>Use your regular Jira username (email) and password</li>
            <li>After adding an instance, click <strong>"ðŸ“¥ Import Worklogs"</strong> to pull your last 30 days of work</li>
            <li>Use <strong>Test</strong> to verify connectivity</li>
            <li>Use <strong>Debug</strong> to troubleshoot worklog retrieval issues</li>
        </ol>

        <h4>ðŸ”§ Connection Troubleshooting</h4>
        <ul>
            <li>Use the <strong>Test</strong> button to check your connection</li>
            <li>Ensure your URL format is correct (e.g., https://your-domain.atlassian.net or https://jira.yourcompany.com)</li>
            <li>Verify your username and password are correct</li>
            <li>Check that your Jira instance is accessible from your network</li>
            <li>After successful connection, click <strong>Import Worklogs</strong> to see your historical data</li>
        </ul>
    </div>
</div>

<style>
.btn-success {
    background: #28a745;
    color: white;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 0.9rem;
    display: inline-block;
    transition: all 0.3s ease;
}

.btn-success:hover {
    background: #218838;
    transform: translateY(-1px);
}

.actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}
</style>
{% endblock %}